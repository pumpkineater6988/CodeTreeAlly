{% extends 'index.html' %}
{% block page_title %}Prompt Optimizer{% endblock %}
{% block content %}
<style>
    .optimizer-container {
        padding: 2rem;
        max-width: 900px;
        margin: auto;
    }

    .optimizer-container h2 {
        margin-bottom: 1.5rem;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    textarea.form-control {
        width: 100%;
        min-height: 120px;
        font-size: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
        resize: vertical;
        background: var(--chat-input-bg);
        color: var(--chat-text);
        border: 1px solid #ccc;
    }

    select.form-control {
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        background: var(--chat-input-bg);
        color: var(--chat-text);
        border: 1px solid #ccc;
    }

    .btn-primary {
        background-color: #007bff;
        color: #fff;
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
    }

    .snippet-box {
        background: #f5f5f5;
        color: #222;
        border-radius: 0.75rem;
        padding: 1rem 1.5rem;
        font-family: monospace;
        overflow-x: auto;
        font-size: 1rem;
        position: relative;
        white-space: pre-wrap;
        margin-bottom: 1rem;
    }

    body.dark-mode .snippet-box {
        background: #2d2d2d;
        color: #f8f8f2;
    }

    .copy-btn {
        position: absolute;
        top: 0.75rem;
        right: 1rem;
        background: transparent;
        border: none;
        color: inherit;
        font-size: 1.1rem;
        cursor: pointer;
    }

    .section-label {
        font-weight: bold;
        margin: 1rem 0 0.5rem;
        display: block;
    }

    .error-msg {
        color: red;
        margin-top: 1rem;
        font-weight: 500;
    }
</style>

<div class="optimizer-container">
    <h2>Prompt Optimizer</h2>
    <form method="POST">
        <div class="form-group">
            <label for="prompt">Enter your prompt:</label>
            <textarea id="prompt" name="prompt" class="form-control" required>{{ original_prompt or '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="tone">Select tone:</label>
            <select id="tone" name="tone" class="form-control">
                <option value="neutral" {% if selected_tone == 'neutral' %}selected{% endif %}>Neutral</option>
                <option value="formal" {% if selected_tone == 'formal' %}selected{% endif %}>Formal</option>
                <option value="friendly" {% if selected_tone == 'friendly' %}selected{% endif %}>Friendly</option>
                <option value="technical" {% if selected_tone == 'technical' %}selected{% endif %}>Technical</option>
            </select>
        </div>

        <div class="form-group">
            <label for="role">Select user role:</label>
            <select id="role" name="role" class="form-control">
                <option value="general" {% if selected_role == 'general' %}selected{% endif %}>General User</option>
                <option value="developer" {% if selected_role == 'developer' %}selected{% endif %}>Developer</option>
                <option value="analyst" {% if selected_role == 'analyst' %}selected{% endif %}>Analyst</option>
                <option value="designer" {% if selected_role == 'designer' %}selected{% endif %}>Designer</option>
            </select>
        </div>

        <button type="submit" class="btn-primary">Optimize</button>
    </form>

    {% if error %}
        <div class="error-msg">{{ error }}</div>
    {% endif %}

    {% if optimized %}
        <label class="section-label">Optimized Prompt:</label>
        <div class="snippet-box" id="optimizedBox">
            <button class="copy-btn" onclick="copyToClipboard('optimizedBox', this)">ðŸ“‹</button>
            {{ optimized }}
        </div>
    {% endif %}

    {% if explanation %}
        <label class="section-label">Explanation of Changes:</label>
        <div class="snippet-box" id="explanationBox">
            <button class="copy-btn" onclick="copyToClipboard('explanationBox', this)">ðŸ“‹</button>
            {{ explanation }}
        </div>
    {% endif %}
</div>

<script>
    function copyToClipboard(id, btn) {
        const el = document.getElementById(id);
        const text = el.innerText;

        navigator.clipboard.writeText(text).then(() => {
            btn.innerText = "âœ…";
            setTimeout(() => { btn.innerText = "ðŸ“‹"; }, 1200);
        });
    }
</script>
{% endblock %}
